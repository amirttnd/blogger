<!DOCTYPE html>
<html ng-app="techBlogger" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head lang="en">
    <meta charset="UTF-8"/>
    <meta th:replace="layout/layout::viewport"/>
    <link rel="stylesheet" th:href="@{/css/jsTree/themes/default/style.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/font-awesome-4.7.0/css/font-awesome.min.css}" type="text/css"/>

    <link rel="stylesheet" th:href="@{/css/admin/styleSheet.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/css/media.css}" type="text/css"/>


    <script type="text/javascript" th:src="@{/js/jquery-3.3.1.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jstree.min.v3.3.4.js}"></script>

    <script type="text/javascript" th:src="@{/js/angular/library/angular1.6.4.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/angular/library/ngJsTree.js}"></script>
    <script type="text/javascript" th:src="@{/js/angular/library/ngJsTree.js}"></script>
    <script type="text/javascript" th:src="@{/js/angular/library/angular-resource.min.js}"></script>


    <script type="text/javascript" th:src="@{/js/angular/module/techBlogger.js}"></script>
    <script type="text/javascript" th:src="@{/js/angular/category/category.js}"></script>
    <script type="text/javascript" th:src="@{/js/angular/category/category.controller.js}"></script>

    <script th:src="@{/js/jstree.min.v3.3.4.js}" type="text/javascript"></script>

    <script th:src="@{/js/bootstrap.min.js}"></script>

    <script type="text/javascript" th:src="@{/js/ckeditor/ckeditor.js}"></script>
    <script type="text/javascript" th:src="@{/js/application.js}"></script>

    <title></title>
</head>
<body>
<div th:replace="layout/layout::adminHeader"></div>
<div class="container" ng-controller="CategoryController as categoryCtrl">
    <h3 class="category-heading">Category Tree</h3>

    <div ng-cloak="">
        <div class="category-search-wrapper" data-ng-show="categoryCtrl.tree.length>0">
            <input class="search form-control" ng-model="search" type="text" placeholder="Search category"/>
        </div>
        <ul class="tree">
            <li class="node" ng-repeat="node in categoryCtrl.tree|filter:search track by $index">

                <span class="text" ng-class="{disabled: !node.category.active}">
                    <a>
                        <i class="fa fa-flash"></i>

                        <span ng-hide="node.category.canEdit">{{node.category.name}}</span>

                        <span ng-show="node.category.canEdit">
                            <form data-ng-submit="categoryCtrl.update(node.category)">
                                <input type="text"
                                       ng-model="node.category.name"
                                       class="form-control" ng-value="node.category.name"/>
                            </form>
                        </span>
                    </a>
                    <span class="actions">
                        <i class="fa fa-plus-circle" data-ng-click="categoryCtrl.allowAddToChild(node)"></i>

                        <i class="fa fa-edit" data-ng-click="categoryCtrl.toggleCanEdit(node.category)"></i>

                        <i class="fa"
                           ng-class="{'fa-toggle-on':node.category.active,'fa-toggle-off':!node.category.active}"
                           data-ng-click="categoryCtrl.toggle(node.category)"></i>

                        <i class="fa fa-trash" data-ng-hide="node.subCategories.length>0"
                           data-ng-click="categoryCtrl.deleteNode(node.category.id)"></i>
                    </span>
                </span>


                <ul class="child">
                    <li class="node" ng-repeat="subCategory in node.subCategories|filter:search track by $index">
                        <span class="text" ng-class="{disabled: !subCategory.active}">
                            <a href="">
                                <i class="fa fa-flash"></i>
                                <span ng-hide="subCategory.canEdit">{{subCategory.name}}</span>
                                <span ng-show="subCategory.canEdit">
                                <form data-ng-submit="categoryCtrl.update(subCategory)">
                                    <input type="text"
                                           ng-model="subCategory.name"
                                           class="form-control" ng-value="subCategory.name"/>
                                </form>
                        </span>
                            </a>
                            <span class="actions" ng-if="subCategory.id">

                                <i class="fa fa-edit" data-ng-click="categoryCtrl.toggleCanEdit(subCategory)"></i>

                                <i class="fa"
                                   ng-class="{'fa-toggle-on':subCategory.active,'fa-toggle-off':!subCategory.active}"
                                   data-ng-click="categoryCtrl.toggle(subCategory)"></i>

                                <i class="fa fa-trash" data-ng-click="categoryCtrl.deleteNode(subCategory.id)"></i>
                            </span>
                        </span>
                    </li>
                    <li class="node" ng-show="node.canAddChild">
                        <form data-ng-submit="categoryCtrl.addChild(node, node.category.id)">
                            <span class="text">
                                <i class="fa fa-flash"></i>
                                <input class="category-box" ng-model="node.name"
                                       type="text" placeholder="Enter category name"/>
                            </span>
                        </form>
                    </li>
                </ul>
            </li>

            <li class="new-category-form">
                <form data-ng-submit="categoryCtrl.newCategory()">
                    <div class="form-group">
                        <label for="name"><i class="fa fa-plus-square">&nbsp;</i>Add new category</label>
                        <input type="text"
                               placeholder="Enter categor name or title"
                               ng-model="categoryCtrl.categoryName"
                               class="form-control" id="name"/>
                    </div>
                    <button type="submit"
                            class="btn btn-success">Save
                    </button>
                </form>

            </li>
        </ul>
    </div>
</div>
</body>
</html>